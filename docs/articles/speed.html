<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Speed of glue • glue</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">glue</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/speed.html">Speed of glue</a>
    </li>
    <li>
      <a href="../articles/transformers.html">Transformers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/glue">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Speed of glue</h1>
                        <h4 class="author">Jim Hester</h4>
            
            <h4 class="date">2017-10-26</h4>
          </div>

    
    
<div class="contents">
<p>Glue is advertised as</p>
<blockquote>
<p>Fast, dependency free string literals</p>
</blockquote>
<p>So what do we mean when we say that glue is fast. This does not mean glue is the fastest thing to use in all cases, however for the features it provides we can confidently say it is fast.</p>
<p>A good way to determine this is to compare it’s speed of execution to some alternatives.</p>
<ul>
<li>
<code><a href="http://www.rdocumentation.org/packages/base/topics/paste">base::paste0()</a></code>, <code>base::printf()</code> - Functions in base R implemented in C that provide variable insertion (but not interpolation).</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/R.utils/topics/gstring">R.utils::gstring()</a></code>, <code>stringr::str_inperp()</code> - Provides a similar interface as glue, but using <code>${}</code> to delimit blocks to interpolate.</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/pystr/topics/pystr_format">pystr::pystr_format()</a></code>, <code><a href="http://www.rdocumentation.org/packages/rprintf/topics/rprintf">rprintf::rprintf()</a></code> - Provide a interfaces similar to python string formatters with variable replacement, but not arbitrary interpolation.</li>
</ul>
<div id="simple-concatenation" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-concatenation" class="anchor"></a>Simple concatenation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar &lt;-<span class="st"> "baz"</span>

simple &lt;-
<span class="st">  </span>microbenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(
  <span class="dt">glue =</span> glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">"foo{bar}"</span>),
  <span class="dt">gstring =</span> R.utils<span class="op">::</span><span class="kw">gstring</span>(<span class="st">"foo${bar}"</span>),
  <span class="dt">paste0 =</span> <span class="kw">paste0</span>(<span class="st">"foo"</span>, bar),
  <span class="dt">pystr_format =</span> pystr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pystr/topics/pystr_format">pystr_format</a></span>(<span class="st">"foo{bar}"</span>, <span class="dt">bar =</span> bar),
  <span class="dt">sprintf =</span> <span class="kw">sprintf</span>(<span class="st">"foo%s"</span>, bar),
  <span class="dt">str_interp =</span> stringr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_interp">str_interp</a></span>(<span class="st">"foo${bar}"</span>),
  <span class="dt">rprintf =</span> rprintf<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rprintf/topics/rprintf">rprintf</a></span>(<span class="st">"foo$bar"</span>, <span class="dt">bar =</span> bar)
)

<span class="kw">print</span>(<span class="dt">unit =</span> <span class="st">"eps"</span>, <span class="dt">order =</span> <span class="st">"median"</span>, <span class="dt">signif =</span> <span class="dv">4</span>, simple)</code></pre></div>
<div class="output">
<pre class="knitr r">#&gt; Unit: evaluations per second
#&gt;          expr       min     lq       mean median     uq     max neval cld
#&gt;       rprintf 2.883e+02   1900   1951.058   1968   2115    2248   100 a  
#&gt;       gstring 6.382e+00   2397   2447.315   2493   2688    2854   100 a  
#&gt;    str_interp 9.663e+01   3272   3297.847   3389   3583    3883   100 a  
#&gt;          glue 3.594e+02   6314   6446.931   6619   7025    7936   100 a  
#&gt;  pystr_format 6.158e+01  18670  20068.661  20040  21560   27880   100 a  
#&gt;        paste0 1.229e+05 393000 468145.291 463100 513700  935500   100  b 
#&gt;       sprintf 2.580e+05 416100 538725.585 465800 613500 1230000   100   c
</pre>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot_comparison</span>(simple)</code></pre></div>
<p><img src="speed_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>While <code>glue()</code> is slower than <code>paste0</code>,<code>sprintf()</code> and <code>pystr_format()</code> it is twice as fast as <code>str_interp()</code> and <code>gstring()</code>, and on par with <code>rprintf()</code>.</p>
<p><code>paste0()</code>, <code>sprintf()</code> don’t do string interpolation and will likely always be significantly faster than glue, glue was never meant to be a direct replacement for them.</p>
<p><code>pystr_format()</code> and <code>rprintf()</code> both do only variable interpolation, not arbitrary expressions, which was one of the explicit points of writing glue.</p>
<p>So glue is ~2x as fast as the two functions (str_interp, gstring) which do have roughly equivalent functionality.</p>
<p>It also is still quite fast, with over 6000 evaluations per second on this machine.</p>
</div>
<div id="vectorized-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#vectorized-performance" class="anchor"></a>Vectorized performance</h2>
<p>Taking advantage of glue’s vectorization is the best way to avoid performance. For instance the vectorized form of the previous benchmark is able to generate 100,000 strings in only 22ms with performance much closer to that of <code>paste0()</code> and <code>sprintf()</code>. NB. <code>str_interp()</code> and <code>pystr_format()</code> do not support vectorization, so were removed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bar &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">"bar"</span>, <span class="fl">1e5</span>)

vectorized &lt;-
<span class="st">  </span>microbenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(
  <span class="dt">glue =</span> glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">"foo{bar}"</span>),
  <span class="dt">gstring =</span> R.utils<span class="op">::</span><span class="kw">gstring</span>(<span class="st">"foo${bar}"</span>),
  <span class="dt">paste0 =</span> <span class="kw">paste0</span>(<span class="st">"foo"</span>, bar),
  <span class="dt">sprintf =</span> <span class="kw">sprintf</span>(<span class="st">"foo%s"</span>, bar),
  <span class="dt">rprintf =</span> rprintf<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rprintf/topics/rprintf">rprintf</a></span>(<span class="st">"foo$bar"</span>, <span class="dt">bar =</span> bar)
)

<span class="kw">print</span>(<span class="dt">unit =</span> <span class="st">"ms"</span>, <span class="dt">order =</span> <span class="st">"median"</span>, <span class="dt">signif =</span> <span class="dv">4</span>, vectorized)</code></pre></div>
<div class="output">
<pre class="knitr r">#&gt; Unit: milliseconds
#&gt;     expr   min    lq     mean median    uq    max neval  cld
#&gt;   paste0 12.81 13.24 14.12517  13.65 14.41  18.11   100 a   
#&gt;  sprintf 16.81 17.24 18.08383  17.76 18.51  21.66   100  b  
#&gt;     glue 19.30 21.00 25.71188  22.55 25.74 158.50   100   c 
#&gt;  gstring 25.96 27.02 28.57572  27.96 30.14  34.33   100   c 
#&gt;  rprintf 60.26 63.50 66.00858  65.56 67.78  79.89   100    d
</pre>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">plot_comparison</span>(vectorized, <span class="dt">log =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="speed_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simple-concatenation">Simple concatenation</a></li>
      <li><a href="#vectorized-performance">Vectorized performance</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>glue is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by Jim Hester.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67989-18', 'auto');
  ga('send', 'pageview');
</script></footer>
</div>

  </body>
</html>
